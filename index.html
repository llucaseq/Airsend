<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>蓝牙文件传输</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 自定义样式 -->
    <link rel="stylesheet" href="style.css">
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#6366F1',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                        dark: '#1F2937',
                        light: '#F3F4F6'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 标题区域 -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">蓝牙文件传输</h1>
            <p class="text-gray-600">通过Web Bluetooth API实现设备间的文件传输</p>
        </header>

        <!-- 主内容区域 -->
        <main class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <!-- 发送方式选择 -->
            <div id="send-method-selector" class="mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-gray-800">发送方式</h3>
                    <span id="method-indicator" class="text-sm font-medium px-3 py-1 rounded-full bg-blue-100 text-blue-800">
                        <i class="fa fa-bluetooth mr-1"></i>蓝牙模式
                    </span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button id="bluetooth-method-btn" class="bg-white border-2 border-primary text-primary hover:bg-blue-50 py-4 px-6 rounded-xl flex items-center justify-center transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg">
                        <div class="text-center">
                            <i class="fa fa-bluetooth text-3xl mb-2"></i>
                            <p class="font-semibold">蓝牙发送</p>
                            <p class="text-xs text-gray-500 mt-1">直接传输到附近设备</p>
                        </div>
                    </button>
                    <button id="cloud-method-btn" class="bg-white border-2 border-gray-200 text-gray-700 hover:bg-gray-50 py-4 px-6 rounded-xl flex items-center justify-center transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg">
                        <div class="text-center">
                            <i class="fa fa-cloud-upload text-3xl mb-2"></i>
                            <p class="font-semibold">云端发送</p>
                            <p class="text-xs text-gray-500 mt-1">生成提取码，安全分享</p>
                        </div>
                    </button>
                </div>
            </div>
            <!-- 浏览器兼容性提示 -->
            <div id="compatibility-alert" class="hidden mb-6 p-4 rounded-lg bg-red-50 text-red-700 border border-red-200">
                <div class="flex items-center">
                    <i class="fa fa-exclamation-triangle mr-3 text-xl"></i>
                    <div>
                        <h3 class="font-bold">您的浏览器不支持Web Bluetooth API</h3>
                        <p class="text-sm">请使用Chrome、Edge等基于Chromium的现代浏览器，并确保使用HTTPS连接。</p>
                    </div>
                </div>
            </div>

            <!-- 文件选择区域 -->
            <section class="mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold flex items-center text-gray-800">
                        <i class="fa fa-file-o mr-2 text-primary"></i>文件选择
                    </h2>
                    <span id="file-count-indicator" class="text-sm font-medium px-3 py-1 rounded-full bg-gray-100 text-gray-700 hidden">
                        <i class="fa fa-files-o mr-1"></i><span id="selected-file-count">0</span> 个文件
                    </span>
                </div>
                
                <!-- 拖拽上传区域 -->
                <div id="upload-area" class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-primary hover:bg-blue-50 transition-all duration-300 cursor-pointer group">
                    <input type="file" id="file-input" class="hidden" multiple>
                    <div class="flex flex-col items-center justify-center">
                        <div class="w-20 h-20 rounded-full bg-blue-100 flex items-center justify-center mb-4 group-hover:bg-blue-200 transition-colors">
                            <i class="fa fa-cloud-upload text-4xl text-primary"></i>
                        </div>
                        <h3 class="text-lg font-medium text-gray-800 mb-2">点击或拖拽文件到此处</h3>
                        <p class="text-gray-600 text-sm mb-4">支持图片、文档、音频、视频等多种格式</p>
                        <button id="browse-files-btn" class="bg-primary hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                            <i class="fa fa-folder-open mr-2"></i>选择文件
                        </button>
                    </div>
                </div>
                
                <!-- 已选择文件列表 -->
                <div id="selected-files" class="mt-4 hidden">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-medium text-gray-700">已选择的文件</h3>
                        <button id="clear-files-btn" class="text-sm text-gray-500 hover:text-danger flex items-center">
                            <i class="fa fa-trash-o mr-1"></i>清空
                        </button>
                    </div>
                    <div id="file-list" class="space-y-3 max-h-60 overflow-y-auto p-4 bg-gray-50 rounded-xl border border-gray-200"></div>
                </div>
            </section>

            <!-- 蓝牙设备区域 -->
            <section id="bluetooth-section" class="mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold flex items-center text-gray-800">
                        <i class="fa fa-bluetooth mr-2 text-primary"></i>蓝牙设备
                    </h2>
                    <span id="bluetooth-status" class="text-sm font-medium px-3 py-1 rounded-full bg-gray-100 text-gray-700">
                        <i class="fa fa-circle mr-1"></i>未连接
                    </span>
                </div>
                
                <!-- 设备操作卡片 -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <button id="scan-devices-btn" class="bg-primary hover:bg-blue-600 text-white py-3 px-6 rounded-lg flex items-center justify-center transition-all duration-300 transform hover:-translate-y-0.5 hover:shadow-md">
                                <i class="fa fa-search mr-2"></i>搜索设备
                            </button>
                            <button id="connected-device-btn" class="bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-6 rounded-lg flex items-center justify-center transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fa fa-link mr-2"></i><span id="connected-device-name">未连接设备</span>
                            </button>
                        </div>
                        
                        <!-- 设备列表 -->
                        <div id="device-list" class="mt-4 hidden">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="font-medium text-gray-700">可用设备</h3>
                                <span id="device-count" class="text-xs text-gray-500">0 个设备</span>
                            </div>
                            <div id="devices" class="space-y-2 max-h-40 overflow-y-auto p-3 bg-gray-50 rounded-lg border border-gray-200"></div>
                        </div>
                    </div>
                    
                    <!-- 蓝牙状态提示 -->
                    <div id="bluetooth-tip" class="bg-blue-50 px-6 py-3 text-sm text-blue-700 border-t border-blue-100">
                        <i class="fa fa-info-circle mr-2"></i>请确保您的设备蓝牙已开启，并使用Chrome或Edge浏览器
                    </div>
                </div>
            </section>

            <!-- 云端发送区域 -->
            <section id="cloud-section" class="mb-8 hidden">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold flex items-center text-gray-800">
                        <i class="fa fa-cloud mr-2 text-primary"></i>云端发送
                    </h2>
                    <span id="cloud-status" class="text-sm font-medium px-3 py-1 rounded-full bg-green-100 text-green-700">
                        <i class="fa fa-check-circle mr-1"></i>可用
                    </span>
                </div>
                
                <!-- 云端发送说明卡片 -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 mb-6 border border-blue-100">
                    <div class="flex items-start">
                        <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mr-4 flex-shrink-0">
                            <i class="fa fa-info-circle text-blue-500 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-blue-800 text-lg mb-2">云端发送说明</h3>
                            <p class="text-blue-700">文件将上传到云端并生成5位数字提取码，接收方可以使用提取码在10分钟内下载文件。</p>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mt-4">
                                <div class="bg-white/60 backdrop-blur-sm rounded-lg p-3 text-center">
                                    <i class="fa fa-shield text-blue-500 mb-1"></i>
                                    <p class="text-xs text-blue-700">安全加密</p>
                                </div>
                                <div class="bg-white/60 backdrop-blur-sm rounded-lg p-3 text-center">
                                    <i class="fa fa-clock-o text-blue-500 mb-1"></i>
                                    <p class="text-xs text-blue-700">10分钟有效期</p>
                                </div>
                                <div class="bg-white/60 backdrop-blur-sm rounded-lg p-3 text-center">
                                    <i class="fa fa-key text-blue-500 mb-1"></i>
                                    <p class="text-xs text-blue-700">5位提取码</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 提取码生成区域 -->
                <div id="extraction-code-section" class="mb-6 hidden">
                    <div class="bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden">
                        <div class="bg-green-50 p-4 border-b border-green-100">
                            <div class="flex items-center justify-center">
                                <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center mr-3">
                                    <i class="fa fa-check text-green-500"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-green-800">文件已上传成功！</h3>
                            </div>
                        </div>
                        <div class="p-6 text-center">
                            <div class="inline-block bg-gray-50 rounded-xl p-6 border-2 border-dashed border-gray-200 mb-4">
                                <span id="extraction-code" class="text-4xl font-bold text-primary tracking-widest font-mono">12345</span>
                            </div>
                            <p class="text-gray-600 mb-4">提取码（有效期10分钟）</p>
                            <div class="flex flex-col sm:flex-row gap-3 justify-center">
                                <button id="copy-code-btn" class="bg-primary hover:bg-blue-600 text-white py-3 px-6 rounded-lg flex items-center justify-center transition-all duration-300 transform hover:-translate-y-0.5 hover:shadow-md">
                                    <i class="fa fa-copy mr-2"></i>复制提取码
                                </button>
                                <button id="share-code-btn" class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 py-3 px-6 rounded-lg flex items-center justify-center transition-all duration-300 transform hover:-translate-y-0.5 hover:shadow-md">
                                    <i class="fa fa-share-alt mr-2"></i>分享
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 提取文件区域 -->
                <div id="receive-file-section">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div class="p-6">
                            <h3 class="font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fa fa-download mr-2 text-primary"></i>接收文件
                            </h3>
                            <p class="text-gray-600 mb-6">请输入5位数字提取码获取文件</p>
                            
                            <div class="flex flex-col sm:flex-row gap-3">
                                <div class="relative flex-1">
                                    <div class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none">
                                        <i class="fa fa-key text-gray-400"></i>
                                    </div>
                                    <input type="text" id="input-extraction-code" class="w-full border-2 border-gray-300 rounded-lg pl-12 pr-4 py-3 text-center text-xl font-mono tracking-widest focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors" placeholder="00000" maxlength="5" pattern="\d{5}">
                                </div>
                                <button id="receive-file-btn" class="bg-primary hover:bg-blue-600 text-white py-3 px-6 rounded-lg flex items-center justify-center transition-all duration-300 transform hover:-translate-y-0.5 hover:shadow-md whitespace-nowrap">
                                    <i class="fa fa-search mr-2"></i>提取文件
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 px-6 py-3 text-sm text-gray-600 border-t border-gray-100">
                            <i class="fa fa-clock-o mr-2"></i>提取码有效期为10分钟，请及时下载文件
                        </div>
                    </div>
                </div>
            </section>

            <!-- 传输控制区域 -->
            <section class="mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold flex items-center text-gray-800">
                        <i class="fa fa-sliders mr-2 text-primary"></i>传输控制
                    </h2>
                    <span id="transfer-status-indicator" class="text-sm font-medium px-3 py-1 rounded-full bg-gray-100 text-gray-700 hidden">
                        <i class="fa fa-circle-o-notch fa-spin mr-1"></i>准备中
                    </span>
                </div>
                
                <!-- 主要控制卡片 -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="p-6">
                        <!-- 发送按钮和增强选项 -->
                        <div class="flex flex-col sm:flex-row items-center justify-between gap-4 mb-4">
                            <button id="send-file-btn" class="bg-success hover:bg-green-600 text-white py-3 px-8 rounded-lg flex items-center justify-center transition-all duration-300 transform hover:-translate-y-0.5 hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:hover:shadow-none" disabled>
                                <i class="fa fa-paper-plane mr-2"></i>发送文件
                            </button>
                            
                            <div class="flex items-center space-x-3 bg-gray-50 px-4 py-2 rounded-lg">
                                <span class="text-gray-700 font-medium">增强传输</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="enhanced-transfer-toggle" class="sr-only peer">
                                    <div class="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[3px] after:left-[3px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-primary"></div>
                                </label>
                            </div>
                        </div>
                        
                        <!-- 传输控制按钮 -->
                        <div id="transfer-controls" class="mt-4 hidden">
                            <div class="flex flex-col sm:flex-row gap-3">
                                <button id="pause-btn" class="flex-1 bg-warning hover:bg-amber-600 text-white py-3 px-6 rounded-lg flex items-center justify-center transition-all duration-300 transform hover:-translate-y-0.5 hover:shadow-md">
                                    <i class="fa fa-pause mr-2"></i>暂停
                                </button>
                                <button id="cancel-btn" class="flex-1 bg-danger hover:bg-red-600 text-white py-3 px-6 rounded-lg flex items-center justify-center transition-all duration-300 transform hover:-translate-y-0.5 hover:shadow-md">
                                    <i class="fa fa-times mr-2"></i>取消
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 增强传输提示 -->
                    <div id="enhanced-tip" class="bg-indigo-50 px-6 py-3 text-sm text-indigo-700 border-t border-indigo-100 hidden">
                        <i class="fa fa-bolt mr-2"></i>增强传输已开启，将优化传输速度和稳定性
                    </div>
                </div>
            </section>

            <!-- 传输进度区域 -->
            <section id="transfer-progress-section" class="mb-8 hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fa fa-tachometer mr-2 text-primary"></i>传输进度
                </h2>
                <div class="bg-gray-200 rounded-full h-4 mb-2 overflow-hidden">
                    <div id="progress-bar" class="bg-primary h-full rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <div class="flex justify-between text-sm text-gray-600 mb-4">
                    <span id="progress-percentage">0%</span>
                    <span id="transfer-speed">0 KB/s</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <p class="text-xs text-gray-500">已传输</p>
                        <p id="transferred-size" class="font-medium">0 KB</p>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <p class="text-xs text-gray-500">总大小</p>
                        <p id="total-size" class="font-medium">0 KB</p>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <p class="text-xs text-gray-500">预计剩余时间</p>
                        <p id="remaining-time" class="font-medium">--:--</p>
                    </div>
                </div>
            </section>

            <!-- 传输记录区域 -->
            <section class="mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold flex items-center">
                        <i class="fa fa-history mr-2 text-primary"></i>传输记录
                    </h2>
                    <button id="clear-history-btn" class="text-sm text-gray-500 hover:text-danger flex items-center">
                        <i class="fa fa-trash-o mr-1"></i>清空记录
                    </button>
                </div>
                <div class="flex flex-wrap gap-2 mb-4">
                    <button class="history-filter-btn bg-primary text-white px-3 py-1 rounded-full text-sm" data-filter="all">全部</button>
                    <button class="history-filter-btn bg-gray-200 text-gray-700 px-3 py-1 rounded-full text-sm" data-filter="success">成功</button>
                    <button class="history-filter-btn bg-gray-200 text-gray-700 px-3 py-1 rounded-full text-sm" data-filter="failed">失败</button>
                </div>
                <div id="transfer-history" class="space-y-3">
                    <div id="no-history" class="text-center py-8 text-gray-500">
                        <i class="fa fa-archive text-4xl mb-3"></i>
                        <p>暂无传输记录</p>
                    </div>
                    <div id="history-list" class="hidden space-y-2"></div>
                </div>
            </section>
        </main>

        <!-- 页脚 -->
        <footer class="text-center text-gray-500 text-sm">
            <p>© 2025 蓝牙文件传输应用 | 基于Web Bluetooth API</p>
        </footer>
    </div>

    <!-- 弹窗 -->
    <!-- 设备搜索弹窗 -->
    <div id="scan-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">搜索蓝牙设备</h3>
                <button id="close-scan-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div id="scan-status" class="mb-4 text-center py-4">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-primary border-t-transparent mb-2"></div>
                <p>正在搜索附近的蓝牙设备...</p>
                <p class="text-sm text-gray-500 mt-1">请确保您的设备蓝牙已开启</p>
            </div>
            <div id="scan-results" class="hidden">
                <h4 class="font-medium mb-2">可用设备</h4>
                <ul id="scan-device-list" class="space-y-2 max-h-60 overflow-y-auto p-2 bg-gray-50 rounded"></ul>
            </div>
            <div class="mt-4 flex justify-end">
                <button id="stop-scan-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 px-4 rounded-lg">
                    停止搜索
                </button>
            </div>
        </div>
    </div>

    <!-- 传输状态弹窗 -->
    <div id="transfer-status-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 id="status-title" class="text-xl font-semibold">传输中</h3>
                <button id="close-status-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div id="status-content" class="mb-4">
                <!-- 动态内容 -->
            </div>
            <div class="mt-4 flex justify-end">
                <button id="status-ok-btn" class="bg-primary hover:bg-blue-600 text-white py-2 px-4 rounded-lg">
                    确定
                </button>
            </div>
        </div>
    </div>

    <!-- 增强技术提示弹窗 -->
    <div id="enhanced-tech-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">蓝牙发送增强技术</h3>
                <button id="close-enhanced-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="mb-4">
                <p class="mb-3">增强技术已开启，将通过以下方式提升传输速度：</p>
                <ul class="list-disc pl-5 space-y-1 text-gray-700">
                    <li>优化数据分块传输策略</li>
                    <li>调整蓝牙连接参数</li>
                    <li>启用数据压缩（如适用）</li>
                    <li>实现智能批量传输</li>
                </ul>
                <p class="mt-3 text-sm text-gray-500">注意：实际效果可能因设备和环境而异。</p>
            </div>
            <div class="mt-4 flex justify-end">
                <button id="enhanced-ok-btn" class="bg-primary hover:bg-blue-600 text-white py-2 px-4 rounded-lg">
                    了解
                </button>
            </div>
        </div>
    </div>

    <!-- 确认弹窗 -->
    <div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
            <h3 id="confirm-title" class="text-xl font-semibold mb-4">确认操作</h3>
            <p id="confirm-message" class="mb-6">您确定要执行此操作吗？</p>
            <div class="flex justify-end space-x-3">
                <button id="confirm-cancel" class="bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 px-4 rounded-lg">
                    取消
                </button>
                <button id="confirm-ok" class="bg-danger hover:bg-red-600 text-white py-2 px-4 rounded-lg">
                    确认
                </button>
            </div>
        </div>
    </div>

    <!-- 主脚本 -->
    <script src="script.js"></script>
</body>
</html>